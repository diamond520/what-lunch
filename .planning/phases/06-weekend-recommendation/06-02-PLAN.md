---
phase: 06-weekend-recommendation
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/app/restaurants/page.tsx
  - src/app/weekend/page.tsx
  - src/components/layout/nav-links.tsx
autonomous: true

must_haves:
  truths:
    - "The /restaurants page has two tabs: '平日餐廳' (weekday) and '假日餐廳' (weekend)"
    - "Adding a restaurant under the weekend tab goes into the weekend list only"
    - "The /weekend page randomly picks 1 restaurant from the weekend pool on button click"
    - "Re-rolling on the weekend page picks a different restaurant (when pool > 1)"
    - "Empty weekend pool shows a prompt with link to /restaurants"
    - "Navigation bar includes '假日推薦' link to /weekend"
  artifacts:
    - path: "src/app/restaurants/page.tsx"
      provides: "Tabbed restaurant management with weekday/weekend switching"
      contains: "TabsTrigger"
    - path: "src/app/weekend/page.tsx"
      provides: "Weekend random restaurant picker page"
      contains: "pickRandomRestaurant"
    - path: "src/components/layout/nav-links.tsx"
      provides: "Navigation with weekend link"
      contains: "/weekend"
  key_links:
    - from: "src/app/restaurants/page.tsx"
      to: "src/lib/restaurant-context.tsx"
      via: "useRestaurants hook — weekend tab uses weekendRestaurants + addWeekendRestaurant"
      pattern: "weekendRestaurants|addWeekendRestaurant"
    - from: "src/app/weekend/page.tsx"
      to: "src/lib/recommend.ts"
      via: "imports pickRandomRestaurant"
      pattern: "import.*pickRandomRestaurant"
    - from: "src/app/weekend/page.tsx"
      to: "src/lib/restaurant-context.tsx"
      via: "useRestaurants hook — reads weekendRestaurants"
      pattern: "weekendRestaurants"
    - from: "src/components/layout/nav-links.tsx"
      to: "/weekend"
      via: "NAV_ITEMS href entry"
      pattern: "href.*weekend"
---

<objective>
Build the two UI pages that complete the weekend feature: (1) refactor /restaurants with tab switching between weekday and weekend lists, and (2) create /weekend random picker page. Also add the nav link.

Purpose: This delivers all user-facing functionality for Phase 6 — the weekend restaurant management and the weekend random picker.
Output: Tabbed restaurant management page, weekend picker page, updated navigation.
</objective>

<execution_context>
@/Users/diamond.hung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/diamond.hung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-weekend-recommendation/06-RESEARCH.md
@.planning/phases/06-weekend-recommendation/06-01-SUMMARY.md

@src/app/restaurants/page.tsx
@src/lib/restaurant-context.tsx
@src/lib/recommend.ts
@src/lib/types.ts
@src/lib/restaurants.ts
@src/components/layout/nav-links.tsx
@src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor /restaurants page with Tabs for weekday/weekend switching</name>
  <files>src/app/restaurants/page.tsx</files>
  <action>
Refactor `src/app/restaurants/page.tsx` to support tab switching between weekday and weekend restaurant lists. The current file is ~470 lines with table + form inlined. Extract a shared panel component to avoid duplication.

1. **Extract a `RestaurantListPanel` component** (can be defined in the same file or a separate component file — same file is simpler):
   - Props interface:
     ```typescript
     interface RestaurantListPanelProps {
       restaurants: Restaurant[]
       defaultRestaurants: Restaurant[]
       addRestaurant: (r: Restaurant) => void
       removeRestaurant: (id: string) => void
       updateRestaurant: (r: Restaurant) => void
       showSaveToConfig?: boolean  // true for weekday, false for weekend
     }
     ```
   - Move ALL existing table + search/filter + form JSX into this component
   - The component manages its own local state: `form`, `errors`, `editingId`, `editForm`, `editErrors`, `search`, `filterCuisine`, `savedIds`
   - The `handleSaveToConfig` function and save/check button column should only render when `showSaveToConfig` is true
   - The `defaultNames` Set should be computed from `defaultRestaurants` prop (not hardcoded DEFAULT_RESTAURANTS)

2. **Add Tabs wrapper to RestaurantsPage**:
   ```typescript
   import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
   import { DEFAULT_WEEKEND_RESTAURANTS } from '@/lib/restaurants'
   ```
   - Destructure from useRestaurants:
     ```typescript
     const {
       restaurants, weekendRestaurants, isHydrated,
       addRestaurant, removeRestaurant, updateRestaurant,
       addWeekendRestaurant, removeWeekendRestaurant, updateWeekendRestaurant,
     } = useRestaurants()
     ```
   - Wrap content in Tabs with `defaultValue="weekday"`:
     ```tsx
     <Tabs defaultValue="weekday">
       <TabsList>
         <TabsTrigger value="weekday">平日餐廳</TabsTrigger>
         <TabsTrigger value="weekend">假日餐廳</TabsTrigger>
       </TabsList>
       <TabsContent value="weekday">
         <RestaurantListPanel
           restaurants={restaurants}
           defaultRestaurants={DEFAULT_RESTAURANTS}
           addRestaurant={addRestaurant}
           removeRestaurant={removeRestaurant}
           updateRestaurant={updateRestaurant}
           showSaveToConfig={true}
         />
       </TabsContent>
       <TabsContent value="weekend">
         <RestaurantListPanel
           restaurants={weekendRestaurants}
           defaultRestaurants={DEFAULT_WEEKEND_RESTAURANTS}
           addRestaurant={addWeekendRestaurant}
           removeRestaurant={removeWeekendRestaurant}
           updateRestaurant={updateWeekendRestaurant}
           showSaveToConfig={false}
         />
       </TabsContent>
     </Tabs>
     ```

3. **Critical detail:** The `handleSaveToConfig` button/logic should ONLY appear in the weekday tab (controlled by `showSaveToConfig` prop). The weekend tab should NOT have save-to-config buttons — per research decision.

4. **Hydration guard:** Keep the existing `if (!isHydrated)` early return. It guards both tabs since `isHydrated` is shared.

5. Keep the page title "餐廳管理" above the Tabs component.

**Anti-patterns to avoid:**
- Do NOT use URL query params for tab state (keep it simple with `defaultValue`)
- Do NOT create separate routes like `/restaurants/weekend`
- Do NOT create a generic `addRestaurant(list, r)` function — keep weekday and weekend CRUD methods explicitly separate (codebase convention)
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npm run build` completes without errors
    - `npm run dev` — visit http://localhost:3000/restaurants, verify:
      - Two tabs visible: "平日餐廳" and "假日餐廳"
      - Weekday tab shows existing restaurant list
      - Weekend tab shows weekend restaurants
      - Adding a restaurant under weekend tab does NOT appear in weekday tab
  </verify>
  <done>
    - /restaurants page has two tabs: "平日餐廳" (weekday, default) and "假日餐廳" (weekend)
    - RestaurantListPanel component extracted to avoid JSX duplication
    - Weekday tab bound to restaurants + weekday CRUD (with save-to-config button)
    - Weekend tab bound to weekendRestaurants + weekend CRUD (no save-to-config button)
    - Adding/removing under weekend tab only affects weekend list
    - Hydration guard covers both tabs
  </done>
</task>

<task type="auto">
  <name>Task 2: Create /weekend picker page and add nav link</name>
  <files>
    src/app/weekend/page.tsx
    src/components/layout/nav-links.tsx
  </files>
  <action>
1. **Create `src/app/weekend/page.tsx`** — a client component for random weekend restaurant picking:

   ```typescript
   'use client'

   import { useState } from 'react'
   import Link from 'next/link'
   import { useRestaurants } from '@/lib/restaurant-context'
   import { pickRandomRestaurant } from '@/lib/recommend'
   import { CUISINE_META } from '@/lib/types'
   import type { Restaurant } from '@/lib/types'
   import { Button } from '@/components/ui/button'
   ```

   Structure:
   a. Use `useRestaurants()` to get `weekendRestaurants` and `isHydrated`
   b. `useState<Restaurant | null>(null)` for `current` pick
   c. Hydration guard: if `!isHydrated`, show skeleton/loading (same pattern as restaurants page)
   d. **Empty state:** if `weekendRestaurants.length === 0`:
      - Show message: "尚未新增假日餐廳"
      - Show a `Link` to `/restaurants` with text like "前往餐廳管理新增假日餐廳" (instruct user to switch to "假日餐廳" tab)
      - Do NOT render the roll button
   e. **Roll button:** "隨機推薦" button that calls:
      ```typescript
      function handleRoll() {
        setCurrent(pickRandomRestaurant(weekendRestaurants))
      }
      ```
   f. **Re-roll button:** "換一間" button that appears only when `current !== null`. Logic:
      ```typescript
      function handleReroll() {
        if (weekendRestaurants.length === 0) return
        const pool = weekendRestaurants.length > 1
          ? weekendRestaurants.filter(r => r.id !== current?.id)
          : weekendRestaurants
        setCurrent(pickRandomRestaurant(pool))
      }
      ```
      This ensures re-roll picks a different restaurant when pool > 1, and gracefully handles pool === 1.
   g. **Result card:** When `current` is not null, display a card showing:
      - Restaurant name (large text)
      - Cuisine badge using inline `style={{ backgroundColor: CUISINE_META[current.type].color }}` (same pattern as restaurants page)
      - Price: `NT$ {current.price}`
      - Distance: `{current.distance}m`
      - Rating: `{current.rating}`
      - Use shadcn Card component if available, otherwise a styled div with `rounded-lg border bg-card p-6 shadow-sm`
   h. Layout: center content in a container (`container mx-auto px-4 py-8`), with the page title "假日推薦" as h1.

2. **Update `src/components/layout/nav-links.tsx`**:
   - Add one entry to `NAV_ITEMS`:
     ```typescript
     const NAV_ITEMS = [
       { href: '/', label: '今日推薦' },
       { href: '/restaurants', label: '餐廳管理' },
       { href: '/weekend', label: '假日推薦' },
     ] as const
     ```
   - No other changes needed.

**Anti-patterns to avoid:**
- Do NOT put re-roll exclusion logic inside `pickRandomRestaurant` — keep it in the page component
- Do NOT use `useEffect` to auto-pick on mount — let the user click the button
- Do NOT import Card component via shadcn CLI (it's not installed) — use a styled div instead
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - `npm run build` completes without errors
    - `npm run dev` — verify:
      1. Navigation bar shows "假日推薦" link
      2. Visit http://localhost:3000/weekend
      3. Click "隨機推薦" — a restaurant card appears
      4. Click "換一間" — a different restaurant appears (if pool > 1)
      5. If weekend pool is empty (clear localStorage), the empty state message with link to /restaurants appears
  </verify>
  <done>
    - /weekend page exists as a client component with hydration guard
    - "隨機推薦" button picks a random restaurant from the weekend pool
    - "換一間" button re-rolls to a different restaurant (handles pool === 1 gracefully)
    - Result card shows name, cuisine badge (inline style), price, distance, rating
    - Empty state shows message + link to /restaurants
    - Navigation bar includes "假日推薦" link to /weekend with active state highlighting
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — zero TypeScript errors
2. `npm run build` — clean build, no warnings
3. Navigation: all three links work (今日推薦, 餐廳管理, 假日推薦)
4. /restaurants: two tabs visible, each manages its own list independently
5. /weekend: roll and re-roll work, empty state shows when no weekend restaurants
6. localStorage: weekend data persists under 'what-lunch-weekend-restaurants' key independently
</verification>

<success_criteria>
- /restaurants page has functional weekday/weekend tab switching with independent CRUD
- /weekend page has working random pick and re-roll
- Empty weekend pool shows helpful prompt with navigation to /restaurants
- Nav bar includes "假日推薦" link that highlights when active
- TypeScript and build both pass cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/06-weekend-recommendation/06-02-SUMMARY.md`
</output>
