---
phase: 10-share-plan
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/layout.tsx
  - src/app/page.tsx
  - src/app/weekend/page.tsx
  - src/components/ui/sonner.tsx
autonomous: false
requirements: []

must_haves:
  truths:
    - "A 'è¤‡è£½è¨ˆç•«' button appears below the plan cards when a weekly plan is generated"
    - "Clicking 'è¤‡è£½è¨ˆç•«' copies a formatted Mon-Fri summary (name, cuisine, price, total cost) to the clipboard"
    - "A toast notification appears confirming 'å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ âœ“' after a successful copy"
    - "Copying fails gracefully with a 'è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½' toast when clipboard is unavailable"
    - "The weekend page shows a 'è¤‡è£½' button alongside 'æ›ä¸€é–“' when a restaurant is displayed"
    - "Clicking the weekend 'è¤‡è£½' button copies the restaurant name, cuisine, price, distance, and rating to the clipboard"
    - "The copied weekly text is plain text readable in LINE or Slack without any markdown artifacts"
    - "Toast notifications respect the active theme (dark toast in dark mode)"
  artifacts:
    - path: "src/components/ui/sonner.tsx"
      provides: "Toaster component wrapping Sonner with next-themes integration"
      contains: "useTheme"
    - path: "src/app/layout.tsx"
      provides: "Root layout with <Toaster /> inside <ThemeProvider>"
      contains: "Toaster"
    - path: "src/app/page.tsx"
      provides: "Weekly picker page with formatWeeklyPlan helper and handleCopy handler"
      contains: "handleCopy"
    - path: "src/app/weekend/page.tsx"
      provides: "Weekend page with handleCopyWeekend handler"
      contains: "handleCopyWeekend"
  key_links:
    - from: "src/app/page.tsx"
      to: "navigator.clipboard"
      via: "handleCopy calling navigator.clipboard.writeText(formatWeeklyPlan(plan))"
      pattern: "navigator\\.clipboard\\.writeText"
    - from: "src/app/weekend/page.tsx"
      to: "navigator.clipboard"
      via: "handleCopyWeekend calling navigator.clipboard.writeText(text)"
      pattern: "navigator\\.clipboard\\.writeText"
    - from: "src/app/layout.tsx"
      to: "src/components/ui/sonner.tsx"
      via: "<Toaster /> inside <ThemeProvider>"
      pattern: "<Toaster"
---

<objective>
Add one-click copy-to-clipboard for both the weekly lunch plan and the weekend single pick, with a Sonner toast confirming success.

Purpose: Let users share their lunch plans in messaging apps (LINE, Slack) without manually typing out the details.
Output: A "è¤‡è£½è¨ˆç•«" button on the home page, a "è¤‡è£½" button on the weekend page, Sonner toast infrastructure in the root layout, and plain-text formatted output for both copy targets.
</objective>

<execution_context>
@/Users/diamond.hung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/diamond.hung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-share-plan/10-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Sonner and wire Toaster into root layout</name>
  <files>src/components/ui/sonner.tsx, src/app/layout.tsx</files>
  <action>
Run `npx shadcn@latest add sonner --yes` to install Sonner and generate `src/components/ui/sonner.tsx`. This installs the `sonner` runtime dependency and creates the shadcn wrapper that reads theme from next-themes.

Then update `src/app/layout.tsx`:
- Add import: `import { Toaster } from '@/components/ui/sonner'`
- Add `<Toaster />` as the last child INSIDE `<ThemeProvider>` (after the `<RestaurantProvider>` block), so it inherits the active theme. Do NOT place it outside `<ThemeProvider>`.

The final layout body should look like:
```tsx
<ThemeProvider attribute="class" defaultTheme="system" enableSystem disableTransitionOnChange>
  <Header />
  <RestaurantProvider>
    <main className="min-h-screen">{children}</main>
  </RestaurantProvider>
  <Toaster />
</ThemeProvider>
```
  </action>
  <verify>`npm run build` completes without TypeScript errors. Check that `src/components/ui/sonner.tsx` exists and contains `useTheme`. Confirm `Toaster` import appears in `src/app/layout.tsx`.</verify>
  <done>`src/components/ui/sonner.tsx` exists with `useTheme` and `Toaster` export. `src/app/layout.tsx` imports and renders `<Toaster />` inside `<ThemeProvider>`. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Add copy button to the weekly lunch picker page</name>
  <files>src/app/page.tsx</files>
  <action>
Update `src/app/page.tsx` with the following additions:

Add imports at the top alongside existing imports:
```ts
import { toast } from 'sonner'
import { Copy } from 'lucide-react'
```

Add `formatWeeklyPlan` helper at module scope (below the constants block, before the component function):
```ts
function formatWeeklyPlan(plan: WeeklyPlan): string {
  const lines = plan.days.map(
    (r, i) => `${DAY_LABELS[i]}ï½œ${r.name} ${CUISINE_META[r.type].label} NT$${r.price}`,
  )
  return ['æœ¬é€±åˆé¤è¨ˆç•« ğŸ±', ...lines, `ç¸½èŠ±è²»ï¼šNT$${plan.totalCost}`].join('\n')
}
```

Note: `ï½œ` is the full-width vertical bar (U+FF5C), not the ASCII pipe `|`. Copy it exactly.

Add `handleCopy` handler inside the `HomePage` component body, alongside `handleGenerate` and `handleReroll`:
```ts
async function handleCopy() {
  if (!plan) return
  if (!navigator.clipboard) {
    toast.error('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½')
    return
  }
  try {
    await navigator.clipboard.writeText(formatWeeklyPlan(plan))
    toast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ âœ“')
  } catch {
    toast.error('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½')
  }
}
```

Modify the plan display section â€” replace the existing `<p>` budget summary line with a flex row containing both the summary text and the copy button:
```tsx
{plan !== null && (
  <>
    <div className="grid grid-cols-1 sm:grid-cols-5 gap-4">
      {/* existing day cards â€” unchanged */}
    </div>
    <div className="mt-4 flex items-center gap-4">
      <p className="text-sm text-muted-foreground">
        æœ¬é€±ç¸½èŠ±è²»ï¼šNT$ {plan.totalCost}ã€€å‰©é¤˜é ç®—ï¼šNT$ {plan.weeklyBudget - plan.totalCost}
      </p>
      <Button variant="outline" size="sm" onClick={handleCopy}>
        <Copy className="size-4 mr-1" />
        è¤‡è£½è¨ˆç•«
      </Button>
    </div>
  </>
)}
```

The existing day-card grid and the history section below remain unchanged.
  </action>
  <verify>`npm run build` passes. In `src/app/page.tsx`: confirm `formatWeeklyPlan` function exists at module scope, `handleCopy` function is defined inside `HomePage`, `Copy` is imported from `lucide-react`, `toast` is imported from `sonner`, and the `è¤‡è£½è¨ˆç•«` button renders inside the `plan !== null` block.</verify>
  <done>The `è¤‡è£½è¨ˆç•«` button appears below the 5-day plan grid when a plan is generated. `handleCopy` uses `navigator.clipboard.writeText()` with try/catch and fires `toast()` on success and `toast.error()` on failure. `formatWeeklyPlan` produces plain-text output with full-width `ï½œ` separators.</done>
</task>

<task type="auto">
  <name>Task 3: Add copy button to the weekend picker page</name>
  <files>src/app/weekend/page.tsx</files>
  <action>
Update `src/app/weekend/page.tsx` with the following additions:

Add imports at the top alongside existing imports:
```ts
import { toast } from 'sonner'
import { Copy } from 'lucide-react'
```

Add `handleCopyWeekend` handler inside the `WeekendPage` component body, alongside `handleRoll` and `handleReroll`:
```ts
async function handleCopyWeekend() {
  if (!current) return
  if (!navigator.clipboard) {
    toast.error('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½')
    return
  }
  const text = [
    'å‡æ—¥æ¨è–¦ ğŸ½ï¸',
    `${current.name} ${CUISINE_META[current.type].label} NT$${current.price}`,
    `è·é›¢ï¼š${current.distance}mï½œè©•åˆ†ï¼š${current.rating}`,
  ].join('\n')
  try {
    await navigator.clipboard.writeText(text)
    toast('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ âœ“')
  } catch {
    toast.error('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½')
  }
}
```

Note: `ï½œ` is the full-width vertical bar (U+FF5C) in the distance/rating line.

Modify the action button row â€” the existing `<div className="flex gap-3 mb-8">` currently conditionally shows `æ›ä¸€é–“`. Add the copy button alongside `æ›ä¸€é–“` (only when `current !== null`):

Current structure:
```tsx
<div className="flex gap-3 mb-8">
  <Button onClick={handleRoll}>éš¨æ©Ÿæ¨è–¦</Button>
  {current !== null && (
    <Button variant="outline" onClick={handleReroll}>
      æ›ä¸€é–“
    </Button>
  )}
</div>
```

Updated structure:
```tsx
<div className="flex gap-3 mb-8">
  <Button onClick={handleRoll}>éš¨æ©Ÿæ¨è–¦</Button>
  {current !== null && (
    <>
      <Button variant="outline" onClick={handleReroll}>
        æ›ä¸€é–“
      </Button>
      <Button variant="outline" onClick={handleCopyWeekend}>
        <Copy className="size-4 mr-1" />
        è¤‡è£½
      </Button>
    </>
  )}
</div>
```

The `current !== null` card display section below remains unchanged.
  </action>
  <verify>`npm run build` passes. In `src/app/weekend/page.tsx`: confirm `handleCopyWeekend` function exists inside `WeekendPage`, `Copy` is imported from `lucide-react`, `toast` is imported from `sonner`, and the `è¤‡è£½` button renders conditionally when `current !== null`.</verify>
  <done>The `è¤‡è£½` button appears alongside `æ›ä¸€é–“` when a weekend restaurant is displayed. `handleCopyWeekend` copies a 3-line plain-text summary (header, restaurant info, distance/rating) using `navigator.clipboard.writeText()` with try/catch and Sonner toast feedback.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 4: Verify copy buttons and toast notifications work end-to-end</name>
  <action>Human verifies the copy feature works by testing both pages in the browser and pasting the result into a text editor or messaging app.</action>
  <what-built>
    Sonner toast infrastructure wired into root layout. "è¤‡è£½è¨ˆç•«" button on the weekly picker page. "è¤‡è£½" button on the weekend picker page. Both use navigator.clipboard.writeText() with toast confirmation.
  </what-built>
  <how-to-verify>
    Run `npm run dev` and open http://localhost:3000.

    Weekly plan copy:
    1. Enter a budget and click "ç”¢ç”Ÿæœ¬é€±åˆé¤è¨ˆç•«" to generate a plan.
    2. Confirm a "è¤‡è£½è¨ˆç•«" button appears below the 5-day cards, next to the budget summary.
    3. Click "è¤‡è£½è¨ˆç•«" â€” a toast should appear with "å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ âœ“".
    4. Open any text editor or messaging app and paste (Cmd+V). Confirm the pasted text looks like:
       æœ¬é€±åˆé¤è¨ˆç•« ğŸ±
       æ˜ŸæœŸä¸€ï½œ[é¤å»³å] [æ–™ç†] NT$[price]
       æ˜ŸæœŸäºŒï½œ[é¤å»³å] [æ–™ç†] NT$[price]
       æ˜ŸæœŸä¸‰ï½œ[é¤å»³å] [æ–™ç†] NT$[price]
       æ˜ŸæœŸå››ï½œ[é¤å»³å] [æ–™ç†] NT$[price]
       æ˜ŸæœŸäº”ï½œ[é¤å»³å] [æ–™ç†] NT$[price]
       ç¸½èŠ±è²»ï¼šNT$[total]
    5. Confirm there is no markdown (no asterisks, backticks, pipes).

    Weekend copy:
    6. Navigate to http://localhost:3000/weekend.
    7. Click "éš¨æ©Ÿæ¨è–¦" to get a result.
    8. Confirm a "è¤‡è£½" button appears alongside "æ›ä¸€é–“".
    9. Click "è¤‡è£½" â€” a toast should appear with "å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ âœ“".
    10. Paste to confirm text is 3-line plain text:
        å‡æ—¥æ¨è–¦ ğŸ½ï¸
        [é¤å»³å] [æ–™ç†] NT$[price]
        è·é›¢ï¼š[X]mï½œè©•åˆ†ï¼š[rating]

    Dark mode:
    11. Toggle to dark mode and click either copy button. Confirm the toast appears in dark style (dark background).
  </how-to-verify>
  <verify>Human confirms all steps above pass.</verify>
  <done>Copy buttons work on both pages. Toast appears and is themed correctly. Pasted text is plain and readable.</done>
  <resume-signal>Type "approved" or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` passes with no TypeScript errors after all three file modifications.
2. `src/components/ui/sonner.tsx` exists and exports `Toaster` using `useTheme` from next-themes.
3. `src/app/layout.tsx` renders `<Toaster />` as the last child inside `<ThemeProvider>`.
4. `src/app/page.tsx` exports `formatWeeklyPlan` at module scope and `handleCopy` inside the component. Copy button renders only when `plan !== null`.
5. `src/app/weekend/page.tsx` exports `handleCopyWeekend` inside the component. Copy button renders only when `current !== null`.
6. Both copy handlers guard against `navigator.clipboard` being undefined before calling `writeText`.
7. Human verification confirms: copy works, toast appears, pasted text is plain and readable.
</verification>

<success_criteria>
- "è¤‡è£½è¨ˆç•«" button appears when a weekly plan is generated and copies a 7-line plain-text summary to clipboard.
- "è¤‡è£½" button appears on the weekend page when a result is shown and copies a 3-line plain-text summary.
- Sonner toast confirms success ("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ âœ“") and shows error on failure.
- Toast respects dark mode (dark toast in dark mode, light toast in light mode).
- `npm run build` passes clean with no TypeScript errors.
- Pasted text contains no markdown artifacts and is readable in LINE/Slack.
</success_criteria>

<output>
After completion, create `.planning/phases/10-share-plan/10-01-SUMMARY.md` following the summary template at @/Users/diamond.hung/.claude/get-shit-done/templates/summary.md
</output>
