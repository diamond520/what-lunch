---
phase: 06-weekend-recommendation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/tabs.tsx
  - src/lib/restaurants.ts
  - src/lib/restaurant-context.tsx
  - src/lib/recommend.ts
  - __tests__/restaurants.test.tsx
  - __tests__/integration.test.tsx
autonomous: true

must_haves:
  truths:
    - "Weekend restaurant list persists independently in localStorage under key 'what-lunch-weekend-restaurants'"
    - "Weekend CRUD operations (add/remove/update) are available via useRestaurants hook"
    - "pickRandomRestaurant returns a random restaurant from a given pool"
    - "Existing tests still pass after context type extension"
  artifacts:
    - path: "src/components/ui/tabs.tsx"
      provides: "shadcn Tabs component for tab switching"
    - path: "src/lib/restaurants.ts"
      provides: "DEFAULT_WEEKEND_RESTAURANTS with wknd- prefix IDs"
      contains: "DEFAULT_WEEKEND_RESTAURANTS"
    - path: "src/lib/restaurant-context.tsx"
      provides: "Extended context with weekendRestaurants state and CRUD"
      contains: "weekendRestaurants"
    - path: "src/lib/recommend.ts"
      provides: "pickRandomRestaurant pure function"
      exports: ["pickRandomRestaurant"]
  key_links:
    - from: "src/lib/restaurant-context.tsx"
      to: "src/lib/restaurants.ts"
      via: "imports DEFAULT_WEEKEND_RESTAURANTS"
      pattern: "import.*DEFAULT_WEEKEND_RESTAURANTS"
    - from: "src/lib/restaurant-context.tsx"
      to: "localStorage"
      via: "useEffect persist with WEEKEND_STORAGE_KEY"
      pattern: "what-lunch-weekend-restaurants"
---

<objective>
Install shadcn Tabs component, add weekend default restaurants, extend RestaurantContext with parallel weekend state and CRUD, add pickRandomRestaurant pure function, and fix existing test mocks to include new context fields.

Purpose: This is the data/state foundation that all weekend UI depends on. Nothing else can be built until the context carries weekend data and the random pick function exists.
Output: Extended context provider, weekend defaults, pickRandomRestaurant function, tabs.tsx component ready for use, all existing tests passing.
</objective>

<execution_context>
@/Users/diamond.hung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/diamond.hung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-weekend-recommendation/06-RESEARCH.md

@src/lib/restaurant-context.tsx
@src/lib/restaurants.ts
@src/lib/recommend.ts
@src/lib/types.ts
@__tests__/restaurants.test.tsx
@__tests__/integration.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn Tabs, add weekend defaults, extend RestaurantContext</name>
  <files>
    src/components/ui/tabs.tsx
    src/lib/restaurants.ts
    src/lib/restaurant-context.tsx
  </files>
  <action>
1. Install shadcn Tabs component:
   ```bash
   npx shadcn@latest add tabs
   ```
   This creates `src/components/ui/tabs.tsx`. Verify it exists after install.

2. Add DEFAULT_WEEKEND_RESTAURANTS to `src/lib/restaurants.ts`:
   - Add after the existing DEFAULT_RESTAURANTS array
   - Use 'wknd-' prefix IDs to avoid collision with weekday IDs
   - Use `satisfies Restaurant[]` (same pattern as DEFAULT_RESTAURANTS)
   - Include 5 weekend-appropriate Taipei restaurants, e.g.:
     ```typescript
     export const DEFAULT_WEEKEND_RESTAURANTS = [
       { id: 'wknd-1', name: '鼎泰豐(信義店)', type: 'chi', price: 600, distance: 3000, rating: 4.7 },
       { id: 'wknd-2', name: '老乾杯(信義店)', type: 'jp', price: 1500, distance: 2800, rating: 4.6 },
       { id: 'wknd-3', name: '鬍鬚張魯肉飯', type: 'chi', price: 120, distance: 500, rating: 4.1 },
       { id: 'wknd-4', name: '欣葉台菜(中山店)', type: 'tai', price: 500, distance: 1500, rating: 4.4 },
       { id: 'wknd-5', name: '饗食天堂(台北館)', type: 'west', price: 800, distance: 2000, rating: 4.3 },
     ] satisfies Restaurant[]
     ```

3. Extend `src/lib/restaurant-context.tsx`:
   a. Import DEFAULT_WEEKEND_RESTAURANTS alongside DEFAULT_RESTAURANTS
   b. Add `WEEKEND_STORAGE_KEY = 'what-lunch-weekend-restaurants'` constant
   c. Refactor `readStoredRestaurants` into a generic helper:
      ```typescript
      function readStoredRestaurantsFromKey(key: string, defaults: Restaurant[]): Restaurant[] {
        if (typeof window === 'undefined') return defaults
        try {
          const stored = localStorage.getItem(key)
          return stored ? JSON.parse(stored) : defaults
        } catch {
          return defaults
        }
      }
      ```
   d. Update existing `readStoredRestaurants` to call `readStoredRestaurantsFromKey(STORAGE_KEY, DEFAULT_RESTAURANTS)`
   e. Extend `RestaurantContextValue` interface to add:
      - `weekendRestaurants: Restaurant[]`
      - `addWeekendRestaurant: (r: Restaurant) => void`
      - `removeWeekendRestaurant: (id: string) => void`
      - `updateWeekendRestaurant: (r: Restaurant) => void`
   f. Inside `RestaurantProvider`, add parallel state:
      ```typescript
      const [weekendRestaurants, setWeekendRestaurants] = useState<Restaurant[]>(
        () => readStoredRestaurantsFromKey(WEEKEND_STORAGE_KEY, DEFAULT_WEEKEND_RESTAURANTS)
      )
      ```
   g. Add useEffect for weekend localStorage persistence (same pattern as weekday, guard with `if (!isHydrated) return`):
      ```typescript
      useEffect(() => {
        if (!isHydrated) return
        try {
          localStorage.setItem(WEEKEND_STORAGE_KEY, JSON.stringify(weekendRestaurants))
        } catch { /* Ignore storage errors */ }
      }, [weekendRestaurants, isHydrated])
      ```
   h. Add weekend CRUD functions (mirror existing pattern):
      ```typescript
      function addWeekendRestaurant(r: Restaurant) {
        setWeekendRestaurants((prev) => [...prev, r])
      }
      function removeWeekendRestaurant(id: string) {
        setWeekendRestaurants((prev) => prev.filter((r) => r.id !== id))
      }
      function updateWeekendRestaurant(r: Restaurant) {
        setWeekendRestaurants((prev) => prev.map((x) => (x.id === r.id ? r : x)))
      }
      ```
   i. Update the context value object to include all new fields:
      ```typescript
      value={{
        restaurants, weekendRestaurants, isHydrated,
        addRestaurant, removeRestaurant, updateRestaurant,
        addWeekendRestaurant, removeWeekendRestaurant, updateWeekendRestaurant,
      }}
      ```
  </action>
  <verify>
    - `ls src/components/ui/tabs.tsx` confirms file exists
    - `npx tsc --noEmit` passes with no errors (context type is consistent)
  </verify>
  <done>
    - shadcn Tabs component installed at src/components/ui/tabs.tsx
    - DEFAULT_WEEKEND_RESTAURANTS exported from restaurants.ts with 5 entries using wknd- prefix IDs
    - RestaurantContextValue interface includes weekendRestaurants + 3 weekend CRUD methods
    - RestaurantProvider manages weekend state with independent localStorage key 'what-lunch-weekend-restaurants'
    - Hydration guard applied to weekend localStorage writes
  </done>
</task>

<task type="auto">
  <name>Task 2: Add pickRandomRestaurant and fix existing test mocks</name>
  <files>
    src/lib/recommend.ts
    __tests__/restaurants.test.tsx
    __tests__/integration.test.tsx
  </files>
  <action>
1. Add `pickRandomRestaurant` to `src/lib/recommend.ts`:
   - Add at the end of the file (after `rerollSlot`):
     ```typescript
     export function pickRandomRestaurant(pool: Restaurant[]): Restaurant {
       if (pool.length === 0) throw new Error('Restaurant pool cannot be empty')
       return pool[Math.floor(Math.random() * pool.length)]
     }
     ```
   - Do NOT modify any existing functions.

2. Fix `__tests__/restaurants.test.tsx` mock context:
   - The `renderWithContext` function provides a context value object. After extending `RestaurantContextValue`, this mock is now missing weekend fields. TypeScript will error.
   - Update the `overrides` type and default context value to include:
     ```typescript
     weekendRestaurants: [],
     addWeekendRestaurant: overrides.addWeekendRestaurant ?? vi.fn(),
     removeWeekendRestaurant: overrides.removeWeekendRestaurant ?? vi.fn(),
     updateWeekendRestaurant: overrides.updateWeekendRestaurant ?? vi.fn(),
     ```
   - Add the weekend override keys to the `Partial<{...}>` type as well.

3. Fix `__tests__/integration.test.tsx`:
   - This file uses `RestaurantProvider` directly (not raw context value), so it may NOT need changes — the provider internally manages weekend state.
   - Check if the file imports or references the context value type directly. If not, no changes needed.
   - Run `npx tsc --noEmit` to confirm.
  </action>
  <verify>
    - `npx tsc --noEmit` passes with no errors
    - `npx vitest run` — all existing tests pass (restaurants.test.tsx, integration.test.tsx, recommend.test.ts)
  </verify>
  <done>
    - pickRandomRestaurant exported from recommend.ts, throws on empty pool, returns random element from pool
    - restaurants.test.tsx mock context includes weekend fields — no TypeScript errors
    - integration.test.tsx compiles and passes
    - All existing tests pass with zero regressions
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — zero TypeScript errors
2. `npx vitest run` — all existing tests pass
3. `ls src/components/ui/tabs.tsx` — file exists
4. `grep 'DEFAULT_WEEKEND_RESTAURANTS' src/lib/restaurants.ts` — exported
5. `grep 'weekendRestaurants' src/lib/restaurant-context.tsx` — in context value
6. `grep 'pickRandomRestaurant' src/lib/recommend.ts` — exported
7. `grep 'what-lunch-weekend-restaurants' src/lib/restaurant-context.tsx` — localStorage key present
</verification>

<success_criteria>
- shadcn Tabs component installed and importable
- Weekend default restaurants defined with wknd- prefix IDs
- RestaurantContext extended with weekend state, CRUD, and independent localStorage persistence
- pickRandomRestaurant pure function exported from recommend.ts
- All existing tests pass without modification regressions
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/06-weekend-recommendation/06-01-SUMMARY.md`
</output>
