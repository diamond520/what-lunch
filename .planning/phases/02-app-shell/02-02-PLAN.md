---
phase: 02-app-shell
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/app/layout.tsx
  - src/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate between / and /restaurants without a full page reload"
    - "The Header persists across both pages — only the page content changes on navigation"
    - "The active nav link (今日推薦 or 餐廳管理) is visually distinct from the inactive one"
    - "Both pages render correctly at 1280px+ desktop viewport with content constrained by container"
    - "npm run build exits 0 with no TypeScript or build errors"
  artifacts:
    - path: "src/app/layout.tsx"
      provides: "Root layout with Header integrated"
      contains: "Header"
    - path: "src/app/page.tsx"
      provides: "/ route placeholder"
      contains: "export default function"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/layout/header.tsx"
      via: "import Header"
      pattern: "from '@/components/layout/header'"
    - from: "src/app/layout.tsx"
      to: "Header component"
      via: "JSX render in body"
      pattern: "<Header"
---

<objective>
Wire the Header into the root layout, update the home page placeholder, run a production build to verify zero errors, then checkpoint for visual navigation verification.

Purpose: This is the final integration step — connecting the navigation components from Plan 01 into the actual running app and confirming the app shell works as a whole.
Output: Modified layout.tsx with Header, updated page.tsx placeholder, passing build, visual confirmation from user.
</objective>

<execution_context>
@/Users/diamond.hung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/diamond.hung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-app-shell/02-RESEARCH.md
@.planning/phases/02-app-shell/02-01-SUMMARY.md
@src/app/layout.tsx
@src/app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire Header into root layout and update home page placeholder</name>
  <files>
    src/app/layout.tsx
    src/app/page.tsx
  </files>
  <action>
Update `src/app/layout.tsx` to import and render the Header Server Component.

Read the current file first. The existing layout has `<html lang="zh-TW">`, Geist font variables, and a `<body>`. Modify it as follows:

1. Add the Header import at the top (after any existing imports):
   ```typescript
   import { Header } from '@/components/layout/header'
   ```

2. Inside the `<body>`, add `<Header />` as the first child, then wrap `{children}` in a `<main>` tag:
   ```typescript
   <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
     <Header />
     <main className="min-h-screen">{children}</main>
   </body>
   ```

   Preserve all existing className values on `<body>` and `<html>` — do not remove the Geist font variables or antialiased class.

   Do NOT add `'use client'` to layout.tsx. It must remain a Server Component.

---

Update `src/app/page.tsx` to be a clear recommendation page placeholder.

Read the current file first. Replace the content with:

```typescript
import { DEFAULT_RESTAURANTS } from '@/lib/restaurants'

export default function HomePage() {
  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-2xl font-semibold">今日推薦</h1>
      <p className="mt-2 text-muted-foreground">
        推薦功能即將在 Phase 3 推出。目前共有 {DEFAULT_RESTAURANTS.length} 間餐廳。
      </p>
    </div>
  )
}
```

Keep the DEFAULT_RESTAURANTS import — it keeps the data model wired in and verifies the import chain.
  </action>
  <verify>
Run: `npx tsc --noEmit` in /Users/diamond.hung/ailabs/code/what-lunch
Expected: exits 0, no errors.
Run: `grep -n "'use client'" /Users/diamond.hung/ailabs/code/what-lunch/src/app/layout.tsx`
Expected: no output (layout.tsx must NOT have "use client")
Run: `grep -n "Header" /Users/diamond.hung/ailabs/code/what-lunch/src/app/layout.tsx`
Expected: lines showing import and JSX usage of Header
  </verify>
  <done>layout.tsx imports Header and renders it before {children}. page.tsx is a clean placeholder. Neither file has "use client". TypeScript passes.</done>
</task>

<task type="auto">
  <name>Task 2: Run production build and dev server to confirm zero errors</name>
  <files></files>
  <action>
Run the production build from the project root:

```bash
cd /Users/diamond.hung/ailabs/code/what-lunch && npm run build
```

Expected outcome: exits 0. The build output should show:
- Route `/` — Static or SSG
- Route `/restaurants` — Static or SSG
- No TypeScript errors
- No "Module not found" errors
- No "use client" boundary violations

If the build fails:
1. Read the error output carefully
2. Fix only the specific error — do not refactor unrelated code
3. Re-run `npm run build` to confirm the fix
4. Common fixes:
   - Missing export: check the file referenced in the error
   - Import path typo: verify the exact path matches the file created in Plan 01
   - "use client" boundary: ensure header.tsx has no "use client", only nav-links.tsx does

After a successful build, start the dev server in the background to prepare for the visual checkpoint:

```bash
cd /Users/diamond.hung/ailabs/code/what-lunch && npm run dev &
```

Wait 3 seconds for the server to start, then confirm it's running:
```bash
sleep 3 && curl -s -o /dev/null -w "%{http_code}" http://localhost:3000
```
Expected: 200
  </action>
  <verify>
`npm run build` exits 0 (no errors in output).
`curl http://localhost:3000` returns HTTP 200.
  </verify>
  <done>Production build exits 0 with / and /restaurants routes compiled. Dev server running at localhost:3000.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete app shell: sticky header with "What Lunch?" brand + shadcn NavigationMenu (今日推薦 / 餐廳管理), two routes (/ and /restaurants), active nav link highlighting via usePathname, production build passing.
  </what-built>
  <how-to-verify>
1. Open http://localhost:3000 in your browser
2. Verify the header is visible at the top with "What Lunch?" on the left and two nav links on the right
3. Verify "今日推薦" nav link appears highlighted/active (different background from "餐廳管理")
4. Click "餐廳管理" — confirm the URL changes to /restaurants WITHOUT a full page reload (the header should NOT flicker or remount)
5. Verify "餐廳管理" is now highlighted as the active link
6. Verify the page shows "餐廳管理" heading and the placeholder text
7. Click "今日推薦" — confirm navigation back to / without full reload
8. Verify "今日推薦" is active again, showing restaurant count text
9. Resize to 1280px+ width — verify header and content are properly contained (not stretching edge-to-edge)
10. The design should look distinctly different from Element UI — shadcn/ui components, clean typography, Tailwind utility styling
  </how-to-verify>
  <resume-signal>Type "approved" if navigation works correctly, or describe any visual/functional issues to fix.</resume-signal>
</task>

</tasks>

<verification>
After completion:
1. `npm run build` exits 0
2. Both / and /restaurants routes are in the build output
3. layout.tsx has Header import and renders it
4. layout.tsx has NO "use client"
5. User has visually confirmed navigation works without full page reload
6. Active link highlighting is working
</verification>

<success_criteria>
- layout.tsx wires Header between body open tag and main content
- npm run build exits 0 (no TypeScript errors, no build errors)
- User confirms: navigation between / and /restaurants has no full page reload
- User confirms: active nav link is visually highlighted
- User confirms: design is distinct from Element UI
</success_criteria>

<output>
After completion, create `.planning/phases/02-app-shell/02-02-SUMMARY.md` using the summary template.
</output>
