---
phase: 05-picker-page-and-deployment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/app/page.tsx]
autonomous: true

must_haves:
  truths:
    - "User can click one button and see a 5-day (Mon-Fri) weekly lunch plan"
    - "Each day shows a recommendation card with restaurant name, cuisine type tag, price, and distance"
    - "User can adjust the weekly budget input and regenerate a plan that respects the new budget"
    - "User can click a re-roll button on any single day to swap that day's pick without affecting the other four days"
  artifacts:
    - path: "src/app/page.tsx"
      provides: "Weekly lunch picker page with budget input, generate button, 5-day cards, per-card re-roll"
      min_lines: 60
      exports: ["default (HomePage)"]
  key_links:
    - from: "src/app/page.tsx"
      to: "src/lib/restaurant-context.tsx"
      via: "useRestaurants() hook"
      pattern: "useRestaurants"
    - from: "src/app/page.tsx"
      to: "src/lib/recommend.ts"
      via: "generateWeeklyPlan and rerollSlot function calls"
      pattern: "generateWeeklyPlan|rerollSlot"
    - from: "src/app/page.tsx"
      to: "src/lib/types.ts"
      via: "CUISINE_META for cuisine tag colors and labels"
      pattern: "CUISINE_META\\[r\\.type\\]"
---

<objective>
Build the weekly lunch picker page — the primary feature of the app.

Purpose: This is the core user-facing feature. Users visit the home page, set a budget, click "generate," and see 5 recommendation cards (Mon-Fri). Each card can be individually re-rolled.

Output: A fully functional `src/app/page.tsx` that wires together the algorithm (Phase 3), the restaurant context (Phase 4), and the UI components into the main page.
</objective>

<execution_context>
@/Users/diamond.hung/.claude/get-shit-done/workflows/execute-plan.md
@/Users/diamond.hung/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/recommend.ts
@src/lib/types.ts
@src/lib/restaurant-context.tsx
@src/app/layout.tsx
@src/app/restaurants/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace src/app/page.tsx with weekly lunch picker</name>
  <files>src/app/page.tsx</files>
  <action>
Replace the current placeholder `src/app/page.tsx` with a `'use client'` component that implements the weekly lunch picker. The complete implementation:

**Imports:**
- `useState` from react
- `useRestaurants` from `@/lib/restaurant-context`
- `generateWeeklyPlan`, `rerollSlot`, `type WeeklyPlan` from `@/lib/recommend`
- `CUISINE_META` from `@/lib/types`
- `Button` from `@/components/ui/button`
- `Input` from `@/components/ui/input`
- `Label` from `@/components/ui/label`
- `RefreshCw` from `lucide-react`

**Constants (module level):**
- `DAY_LABELS = ['星期一', '星期二', '星期三', '星期四', '星期五']`
- `DEFAULT_BUDGET = 750`
- `BUDGET_MIN = 100`, `BUDGET_MAX = 2000`, `BUDGET_STEP = 10`

**State:**
- `budget: number` — initialized to `DEFAULT_BUDGET`
- `plan: WeeklyPlan | null` — initialized to `null`

**Handlers:**
- `handleGenerate()` — guards against empty pool (`restaurants.length === 0`) and NaN budget (`isNaN(budget)`), then calls `setPlan(generateWeeklyPlan(restaurants, budget))`
- `handleReroll(index: number)` — guards against null plan, calls `setPlan(rerollSlot(plan, index, restaurants))`
- Budget `onChange` — sets budget via `e.target.valueAsNumber`, clears plan (`setPlan(null)`) when budget changes to avoid stale plan confusion

**Layout:**
- Container div with `container mx-auto px-4 py-8`
- Heading: `<h1 className="text-2xl font-semibold mb-6">每週午餐推薦</h1>`
- Budget section: `flex items-center gap-4 mb-6` containing:
  - `<Label htmlFor="budget">每週預算 (NT$)</Label>`
  - `<Input id="budget" type="number" min={BUDGET_MIN} max={BUDGET_MAX} step={BUDGET_STEP} value={budget} onChange={...} className="w-32" />`
  - `<Button onClick={handleGenerate}>產生本週午餐計畫</Button>`
  - Disable the generate button if `restaurants.length === 0` and show text "（請先新增餐廳）" when pool is empty
- Plan display (only when `plan` is not null):
  - Grid: `grid grid-cols-1 sm:grid-cols-5 gap-4`
  - Each day card: `<div key={i} className="rounded-lg border bg-card p-4 flex flex-col gap-2">`
    - Day label: `<p className="text-sm font-medium text-muted-foreground">{DAY_LABELS[i]}</p>`
    - Restaurant name: `<p className="font-semibold">{r.name}</p>`
    - Cuisine tag with inline style: `<span className="inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium text-white w-fit" style={{ backgroundColor: CUISINE_META[r.type].color }}>{CUISINE_META[r.type].label}</span>`
    - Price: `<p className="text-sm">NT$ {r.price}</p>`
    - Distance: `<p className="text-sm text-muted-foreground">{r.distance} m</p>`
    - Re-roll button: `<Button variant="outline" size="sm" onClick={() => handleReroll(i)}><RefreshCw className="h-3 w-3 mr-1" />重抽</Button>`
  - Summary: `<p className="mt-4 text-sm text-muted-foreground">本週總花費：NT$ {plan.totalCost}　剩餘預算：NT$ {plan.weeklyBudget - plan.totalCost}</p>`

**Critical patterns (from existing codebase decisions):**
- Use `style={{ backgroundColor: CUISINE_META[r.type].color }}` for cuisine tags — NOT Tailwind classes
- Use `'use client'` directive — page needs useState and useRestaurants context
- No unused imports — DEPLOY-02 requires zero warnings
- `key={i}` is acceptable for the 5-day fixed-length, non-reorderable list
  </action>
  <verify>
1. `npx tsc --noEmit` — no TypeScript errors
2. `npx eslint src/app/page.tsx` — no lint warnings
3. `npm run build` — compiles successfully with zero errors and zero warnings, all routes show `○ (Static)`
4. `npm run dev` — home page loads, shows budget input and generate button
  </verify>
  <done>
- Home page renders budget input (default 750), generate button, and empty state
- Clicking generate shows 5 recommendation cards (Mon-Fri) with name, cuisine tag, price, distance
- Changing budget clears displayed plan; regenerating uses the new budget
- Clicking re-roll on any card swaps that day's pick, other 4 unchanged
- `npm run build` completes with zero errors and zero warnings
  </done>
</task>

</tasks>

<verification>
1. `npm run build` — zero errors, zero warnings, all routes `○ (Static)`
2. `npx vitest run` — all existing 22 tests pass (no regressions)
3. `npx eslint src/` — zero warnings across all files
4. Manual check: `npm run dev` → visit `/` → set budget → click generate → see 5 cards → click re-roll → single card changes
</verification>

<success_criteria>
- Home page shows budget input (default NT$750) and a generate button
- Clicking generate produces a 5-day lunch plan with cards showing name, cuisine tag (with correct color), price, distance
- Budget can be changed and plan regenerated (old plan clears on budget change)
- Re-roll button swaps a single day without affecting others
- `npm run build` completes with zero errors and warnings
- All 22 existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-picker-page-and-deployment/05-01-SUMMARY.md`
</output>
